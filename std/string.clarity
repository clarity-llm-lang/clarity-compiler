module StdString

// String length
export function length(s: String) -> Int64 {
  string_length(s)
}

// Concatenate two strings
export function concat(a: String, b: String) -> String {
  a ++ b
}

// Check if a string contains a substring
export function has(haystack: String, needle: String) -> Bool {
  contains(haystack, needle)
}

// Find index of substring (-1 if not found)
export function find(haystack: String, needle: String) -> Int64 {
  index_of(haystack, needle)
}

// Trim whitespace from both ends
export function strip(s: String) -> String {
  trim(s)
}

// Get a substring
export function slice(s: String, start: Int64, len: Int64) -> String {
  substring(s, start, len)
}

// Get character at index (empty string if out of bounds)
export function at(s: String, index: Int64) -> String {
  char_at(s, index)
}

// Split a string by delimiter
export function split_by(s: String, delim: String) -> List<String> {
  split(s, delim)
}

// Check if a string is empty
export function is_blank(s: String) -> Bool {
  string_length(s) == 0
}

// Repeat a string n times
export function repeat(s: String, n: Int64) -> String {
  repeat_helper(s, n, "")
}

function repeat_helper(s: String, remaining: Int64, acc: String) -> String {
  match remaining <= 0 {
    True -> acc,
    False -> repeat_helper(s, remaining - 1, acc ++ s)
  }
}

// Parse string to Int64 (returns Option<Int64>)
export function to_int(s: String) -> Option<Int64> {
  string_to_int(s)
}

// Parse string to Float64 (returns Option<Float64>)
export function to_float(s: String) -> Option<Float64> {
  string_to_float(s)
}

// Join a list of strings with a separator.
// Example: join(["a", "b", "c"], ", ") returns "a, b, c"
export function join(parts: List<String>, sep: String) -> String {
  match is_empty(parts) {
    True -> "",
    False -> join_helper(tail(parts), sep, head(parts))
  }
}

function join_helper(parts: List<String>, sep: String, acc: String) -> String {
  match is_empty(parts) {
    True -> acc,
    False -> join_helper(tail(parts), sep, acc ++ sep ++ head(parts))
  }
}

// Check if a string starts with a prefix.
export function starts_with(s: String, prefix: String) -> Bool {
  string_starts_with(s, prefix)
}

// Check if a string ends with a suffix.
export function ends_with(s: String, suffix: String) -> Bool {
  string_ends_with(s, suffix)
}

// Escape a string for safe embedding in a JSON string value (no surrounding quotes).
export function json_escape(s: String) -> String {
  json_escape_string(s)
}
